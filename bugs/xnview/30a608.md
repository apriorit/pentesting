# XnView Standard v2.48 TIF processing OOB, xnview+0x30a608

Last version at the moment of publication is 2.48

![](https://i.imgur.com/IHBmtQS.png)

![](https://i.imgur.com/bJ95x8t.png)


## Steps to reproduce

1. Use XnView Standard v2.48
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable xnview.exe /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    xnview.exe: page heap enabled
```
3. Run windbg
4. Open XnView in windbg
5. Open testcase in XnView

## The bug

TIF file processing OOB

```
(a50.ad8): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=0001003f ebx=0d56f9ea ecx=0000c0c0 edx=09079000 esi=00000801 edi=00cfc81c
eip=0108a608 esp=00cfc7a4 ebp=00cfc7b0 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206
xnview+0x30a608:
0108a608 66890a          mov     word ptr [edx],cx        ds:002b:09079000=????
0:000> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 00cfc7b0 0108a898 0d56f3d0 000004b4 09079000 xnview+0x30a608
01 00cfc7e0 0108a1c0 0d5faf60 00cfc81c 18c28900 xnview+0x30a898
02 00cfcb88 00fb4505 0d5faf60 1a194ca8 1a194ca8 xnview+0x30a1c0
03 00cfcba4 00fb4424 0d5faf60 1a194ca8 00000000 xnview+0x234505
04 00cfcccc 00fb8735 0d5faf60 1a194ca8 0000001e xnview+0x234424
05 00cfcd00 00fb84cc 00cfd180 00cfcd54 00cfcd88 xnview+0x238735
06 00cfcd28 00e9334a 00cfd180 00cfcd54 00cfcd88 xnview+0x2384cc
07 00cfce80 00e93586 0000ffff 00cfcea0 80006011 xnview+0x11334a
08 00cfd438 00e93bcf 80006011 001202dc 00000001 xnview+0x113586
09 00cfd57c 76c0be6b 001202dc 0000004e 00000000 xnview+0x113bcf
0a 00cfd5a8 76be9e65 00e93a20 001202dc 0000004e USER32!_InternalCallWinProc+0x2b
0b 00cfd640 76be95e7 001202dc 0000004e 00000000 USER32!UserCallDlgProcCheckWow+0x1e5
0c 00cfd698 76be7695 070bf070 00000000 0000004e USER32!DefDlgProcWorker+0xc7
0d 00cfd6b8 76c0be6b 001202dc 0000004e 00000000 USER32!DefDlgProcA+0x25
0e 00cfd6e4 76c0833a 76be7670 001202dc 0000004e USER32!_InternalCallWinProc+0x2b
0f 00cfd7cc 76bebeca 912a9d10 00007ff9 0000004e USER32!UserCallWinProcCheckWow+0x3aa
10 00cfd838 76bebc57 070bf070 00000000 00cfd994 USER32!SendMessageWorker+0x20a
11 00cfd87c 71b55ce0 001202dc 0000004e 00000000 USER32!SendMessageW+0x137
12 00cfd920 71b6caca 00cfd994 0017025c 001202dc COMCTL32!CCSendNotify+0x2b940
13 00cfd95c 76a9e4cf 001202dc 0017025c fffffda6 COMCTL32!SendNotify+0x3a
14 00cfdab4 76a9f1c8 fffffda6 00000000 112f8fa8 COMDLG32!SendOFNotify+0x7b
15 00cfdad4 76a7ee4b 1899efd8 113409cc 00000003 COMDLG32!CLegacyEvents::OnSelectionChange+0x38
16 00cfdaec 71b3c6fa 1899efd8 113409cc 113409c0 COMDLG32!CFileOpenSave::_NotifySelectionChangeCallback+0x2b
17 00cfdb08 76a6b51c 189a0fe8 76a7ee20 113409cc COMCTL32!DPA_EnumCallback+0x3a
18 00cfdb18 76a7edb1 00000000 113409c0 00000000 COMDLG32!CFileOpenSave::NotifySelectionChangeWithoutParsing+0x1a
19 00cfdb58 76a86548 80006011 0017025c 00000001 COMDLG32!CFileOpenSave::_NotifySelectionChange+0x22
1a 00cfdbc4 76c0be6b 0017025c 0000052e 00000000 COMDLG32!CFileOpenSave::s_OpenSaveDlgProc+0x7e8
1b 00cfdbf0 76be9e65 76a85d60 0017025c 0000052e USER32!_InternalCallWinProc+0x2b
1c 00cfdc88 76be95e7 0017025c 0000052e 00000000 USER32!UserCallDlgProcCheckWow+0x1e5
1d 00cfdce4 76be9508 0708ec10 00000000 0000052e USER32!DefDlgProcWorker+0xc7
1e 00cfdd08 76c0be6b 0017025c 0000052e 00000000 USER32!DefDlgProcW+0x48
1f 00cfdd34 76c0833a 76be94c0 0017025c 0000052e USER32!_InternalCallWinProc+0x2b
20 00cfde1c 76c07bee 912a9d20 00007ff9 0000052e USER32!UserCallWinProcCheckWow+0x3aa
21 00cfde98 76bea2c3 0015079a 00000000 0017025c USER32!DispatchMessageWorker+0x20e
22 00cfdec8 76be903f 0017025c 00cfdee4 0015079a USER32!IsDialogMessageW+0x103
23 00cfdf10 76be4b0a 00000000 00000001 189a8fc8 USER32!DialogBox2+0x13e
24 00cfdf44 76be4a22 0015079a 76a85d60 113409c0 USER32!InternalDialogBox+0xdf
25 00cfdf5c 76be49db 76a30000 112b6d10 0015079a USER32!DialogBoxIndirectParamAorW+0x32
26 00cfdf7c 76a732f6 76a30000 112b6d10 0015079a USER32!DialogBoxIndirectParamW+0x1b
27 00cfe0b8 76a7d5ed 113409c4 0015079a 00000000 COMDLG32!CFileOpenSave::Show+0x346
28 00cfe0ec 76a78dc7 0015079a 00cfe134 00000000 COMDLG32!_InvokeNewFileOpenSave+0xdb
29 00cfe11c 76a6a8e1 00cfe134 76a4a2e0 112f8fa8 COMDLG32!_CreateNewFileOpenSaveInProc+0xd7
2a 00cfe150 76a4b215 00cff290 112f8fa8 00000000 COMDLG32!NewGetFileName+0x122
2b 00cfe178 76a4afa3 77276100 1130acc8 113108f0 COMDLG32!GetFileName+0xd4
2c 00cff25c 76a4b9c2 00cff3f0 00e94618 00cff290 COMDLG32!GenericGetFileNameA+0x541
2d 00cff264 00e94618 00cff290 76c0d330 00000000 COMDLG32!GetOpenFileNameA+0x22
2e 00cff3f0 00f02ac7 00cff424 00cff420 00000001 xnview+0x114618
2f 00cff534 00e8c433 0015079a 0001000b 00000001 xnview+0x182ac7
30 00cff560 00f06826 0000001a 00000001 00000000 xnview+0x10c433
31 00cff57c 00e8c343 0015079a 00000111 0001000b xnview+0x186826
32 00cff5a4 00f068e9 00000111 0001000b 00000000 xnview+0x10c343
33 00cff5b8 76c0be6b 0015079a 00000111 0001000b xnview+0x1868e9
34 00cff5e4 76c0833a 00f068d0 0015079a 00000111 USER32!_InternalCallWinProc+0x2b
35 00cff6cc 76c07eda 00f068d0 00000000 00000111 USER32!UserCallWinProcCheckWow+0x3aa
36 00cff730 76c0a629 070ceee0 00000000 00000111 USER32!DispatchClientMessage+0xea
37 00cff770 76f9b96d 00cff78c 00000020 00cff9b4 USER32!__fnDWORD+0x49
38 00cff7a8 740d2bec 76bf89ff 0015079a 013a018b ntdll!KiUserCallbackDispatcher+0x4d
39 00cff7ac 76bf89ff 0015079a 013a018b 00cff80c win32u!NtUserTranslateAccelerator+0xc
3a 00cff7cc 00f0a293 0015079a 013a018b 00cff80c USER32!TranslateAcceleratorA+0x4f
3b 00cff978 01104d80 00d80000 00000000 03c9fff8 xnview+0x18a293
3c 00cff9c4 76d78484 00a93000 76d78460 3f897c60 xnview+0x384d80
3d 00cff9d8 76f92ec0 00a93000 96dacd23 00000000 KERNEL32!BaseThreadInitThunk+0x24
3e 00cffa20 76f92e90 ffffffff 76faded7 00000000 ntdll!__RtlUserThreadStart+0x2f
3f 00cffa30 00000000 01104c79 00a93000 00000000 ntdll!_RtlUserThreadStart+0x1b
```
