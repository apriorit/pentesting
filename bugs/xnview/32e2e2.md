# XnView Standard v2.48 TIF processing OOB, xnview+0x32e2e2

Last version at the moment of publication is 2.48

![](https://i.imgur.com/IHBmtQS.png)

![](https://i.imgur.com/bJ95x8t.png)


## Steps to reproduce

1. Use XnView Standard v2.48
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable xnview.exe /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    xnview.exe: page heap enabled
```
3. Run windbg
4. Open XnView in windbg
5. Open testcase in XnView

## The bug

TIF file processing OOB

```
(1094.154c): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=000000f1 ebx=1eafce68 ecx=0000000a edx=1eafd000 esi=cf034cf1 edi=00000009
eip=0151e2e2 esp=010fc008 ebp=010fc03c iopl=0         nv up ei ng nz ac pe cy
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010297
xnview+0x32e2e2:
0151e2e2 0fb602          movzx   eax,byte ptr [edx]         ds:002b:1eafd000=??
0:000> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 010fc03c 014ee48b 0f8fef60 0f890b76 0000008a xnview+0x32e2e2
01 010fc384 014ece09 0f8fef60 0f890800 010fc51c xnview+0x2fe48b
02 010fc60c 014ec5e0 0f8fef60 0f8d8ca8 00000000 xnview+0x2fce09
03 010fc620 01424505 0f8fef60 0f8d8ca8 0f8d8ca8 xnview+0x2fc5e0
04 010fc63c 01424424 0f8fef60 0f8d8ca8 00000000 xnview+0x234505
05 010fc764 01428735 0f8fef60 0f8d8ca8 00000002 xnview+0x234424
06 010fc798 014284cc 010fcc18 010fc7ec 010fc820 xnview+0x238735
07 010fc7c0 0130334a 010fcc18 010fc7ec 010fc820 xnview+0x2384cc
08 010fc918 01303586 0000ffff 010fc938 80006011 xnview+0x11334a
09 010fced0 01303bcf 80006011 000a0444 00000001 xnview+0x113586
0a 010fd014 76c0be6b 000a0444 0000004e 00000000 xnview+0x113bcf
0b 010fd040 76be9e65 01303a20 000a0444 0000004e USER32!_InternalCallWinProc+0x2b
0c 010fd0d8 76be95e7 000a0444 0000004e 00000000 USER32!UserCallDlgProcCheckWow+0x1e5
0d 010fd130 76be7695 07584d30 00000000 0000004e USER32!DefDlgProcWorker+0xc7
0e 010fd150 76c0be6b 000a0444 0000004e 00000000 USER32!DefDlgProcA+0x25
0f 010fd17c 76c0833a 76be7670 000a0444 0000004e USER32!_InternalCallWinProc+0x2b
10 010fd264 76bebeca 912a9d10 00007ff9 0000004e USER32!UserCallWinProcCheckWow+0x3aa
11 010fd2d0 76bebc57 07584d30 00000000 010fd42c USER32!SendMessageWorker+0x20a
12 010fd314 71b55ce0 000a0444 0000004e 00000000 USER32!SendMessageW+0x137
13 010fd3b8 71b6caca 010fd42c 00270554 000a0444 COMCTL32!CCSendNotify+0x2b940
14 010fd3f4 76a9e4cf 000a0444 00270554 fffffda6 COMCTL32!SendNotify+0x3a
15 010fd54c 76a9f1c8 fffffda6 00000000 1175cfa8 COMDLG32!SendOFNotify+0x7b
16 010fd56c 76a7ee4b 18e2cfd8 117b69cc 00000003 COMDLG32!CLegacyEvents::OnSelectionChange+0x38
17 010fd584 71b3c6fa 18e2cfd8 117b69cc 117b69c0 COMDLG32!CFileOpenSave::_NotifySelectionChangeCallback+0x2b
18 010fd5a0 76a6b51c 18e2efe8 76a7ee20 117b69cc COMCTL32!DPA_EnumCallback+0x3a
19 010fd5b0 76a7edb1 00000000 117b69c0 00000000 COMDLG32!CFileOpenSave::NotifySelectionChangeWithoutParsing+0x1a
1a 010fd5f0 76a86548 80006011 00270554 00000001 COMDLG32!CFileOpenSave::_NotifySelectionChange+0x22
1b 010fd65c 76c0be6b 00270554 0000052e 00000000 COMDLG32!CFileOpenSave::s_OpenSaveDlgProc+0x7e8
1c 010fd688 76be9e65 76a85d60 00270554 0000052e USER32!_InternalCallWinProc+0x2b
1d 010fd720 76be95e7 00270554 0000052e 00000000 USER32!UserCallDlgProcCheckWow+0x1e5
1e 010fd77c 76be9508 07583060 00000000 0000052e USER32!DefDlgProcWorker+0xc7
1f 010fd7a0 76c0be6b 00270554 0000052e 00000000 USER32!DefDlgProcW+0x48
20 010fd7cc 76c0833a 76be94c0 00270554 0000052e USER32!_InternalCallWinProc+0x2b
21 010fd8b4 76c07bee 912a9d20 00007ff9 0000052e USER32!UserCallWinProcCheckWow+0x3aa
22 010fd930 76c079d0 17483f4a 010fd988 71b7ac8d USER32!DispatchMessageWorker+0x20e
23 010fd93c 71b7ac8d 010fd968 00000006 00000000 USER32!DispatchMessageW+0x10
24 010fd988 71c835bc 0000008f 00000000 00000000 COMCTL32!CheckForDragBeginEx+0xdd
25 010fda44 71b4cdaf 00000000 0000004f 0000008f COMCTL32!CLVMouseManager::HandleMouse+0x828
26 010fdbcc 71b1e8c7 000d003e 00000201 00000001 COMCTL32!CListView::WndProc+0x2d41f
27 010fdbf8 76c0be6b 000d003e 00000201 00000001 COMCTL32!CListView::s_WndProc+0x57
28 010fdc24 76c0833a 71b1e870 000d003e 00000201 USER32!_InternalCallWinProc+0x2b
29 010fdd0c 76be7afd 71b1e870 00000000 00000201 USER32!UserCallWinProcCheckWow+0x3aa
2a 010fdd48 71b3aadd 71b1e870 000d003e 00000201 USER32!CallWindowProcW+0x8d
2b 010fddd0 71b3ab7b 00000201 00000001 008f004f COMCTL32!CallNextSubclassProc+0x11d
2c 010fde50 71b3a876 00000201 00000001 008f004f COMCTL32!CallNextSubclassProc+0x1bb
2d 010fde70 75360d11 000d003e 00000201 00000001 COMCTL32!DefSubclassProc+0x56
2e 010fe100 71b3aa82 000d003e 00000201 00000001 SHELL32!CListViewHost::s_ListViewSubclassWndProc+0x511
2f 010fe18c 71b3a935 00000201 00000001 008f004f COMCTL32!CallNextSubclassProc+0xc2
30 010fe1e8 76c0be6b 000d003e 00000201 00000001 COMCTL32!MasterSubclassProc+0xa5
31 010fe214 76c0833a 71b3a890 000d003e 00000201 USER32!_InternalCallWinProc+0x2b
32 010fe2fc 76c07bee 71b3a890 00000000 00000201 USER32!UserCallWinProcCheckWow+0x3aa
33 010fe378 76bea2c3 000d075e 00000000 00270554 USER32!DispatchMessageWorker+0x20e
34 010fe3a8 76be903f 00270554 010fe3c4 000d075e USER32!IsDialogMessageW+0x103
35 010fe3f0 76be4b0a 00000000 00000001 18e36fc8 USER32!DialogBox2+0x13e
36 010fe424 76be4a22 000d075e 76a85d60 117b69c0 USER32!InternalDialogBox+0xdf
37 010fe43c 76be49db 76a30000 117d0d10 000d075e USER32!DialogBoxIndirectParamAorW+0x32
38 010fe45c 76a732f6 76a30000 117d0d10 000d075e USER32!DialogBoxIndirectParamW+0x1b
39 010fe598 76a7d5ed 117b69c4 000d075e 00000000 COMDLG32!CFileOpenSave::Show+0x346
3a 010fe5cc 76a78dc7 000d075e 010fe614 00000000 COMDLG32!_InvokeNewFileOpenSave+0xdb
3b 010fe5fc 76a6a8e1 010fe614 76a4a2e0 1175cfa8 COMDLG32!_CreateNewFileOpenSaveInProc+0xd7
3c 010fe630 76a4b215 010ff770 1175cfa8 00000000 COMDLG32!NewGetFileName+0x122
3d 010fe658 76a4afa3 be084542 1170acc8 117128f0 COMDLG32!GetFileName+0xd4
3e 010ff73c 76a4b9c2 010ff8d0 01304618 010ff770 COMDLG32!GenericGetFileNameA+0x541
3f 010ff744 01304618 010ff770 76c0d330 00000000 COMDLG32!GetOpenFileNameA+0x22
40 010ff8d0 01372ac7 010ff904 010ff900 00000001 xnview+0x114618
41 010ffa14 012fc433 000d075e 0001000b 00000001 xnview+0x182ac7
42 010ffa40 01376826 0000001a 00000001 00000000 xnview+0x10c433
43 010ffa5c 012fc343 000d075e 00000111 0001000b xnview+0x186826
44 010ffa84 013768e9 00000111 0001000b 00000000 xnview+0x10c343
45 010ffa98 76c0be6b 000d075e 00000111 0001000b xnview+0x1868e9
46 010ffac4 76c0833a 013768d0 000d075e 00000111 USER32!_InternalCallWinProc+0x2b
47 010ffbac 76c07eda 013768d0 00000000 00000111 USER32!UserCallWinProcCheckWow+0x3aa
48 010ffc10 76c0a629 0755e270 00000000 00000111 USER32!DispatchClientMessage+0xea
49 010ffc50 76f9b96d 010ffc6c 00000020 010ffe98 USER32!__fnDWORD+0x49
4a 010ffc88 740d2bec 76bf89ff 000d075e 00580489 ntdll!KiUserCallbackDispatcher+0x4d
4b 010ffc8c 76bf89ff 000d075e 00580489 010ffcec win32u!NtUserTranslateAccelerator+0xc
4c 010ffcac 0137a293 000d075e 00580489 010ffcec USER32!TranslateAcceleratorA+0x4f
4d 010ffe5c 01574d80 011f0000 00000000 0415fff8 xnview+0x18a293
4e 010ffea8 76d78484 00e5f000 76d78460 3d8543af xnview+0x384d80
4f 010ffebc 76f92ec0 00e5f000 19914f90 00000000 KERNEL32!BaseThreadInitThunk+0x24
50 010fff04 76f92e90 ffffffff 76fadeaa 00000000 ntdll!__RtlUserThreadStart+0x2f
51 010fff14 00000000 01574c79 00e5f000 00000000 ntdll!_RtlUserThreadStart+0x1b

```
