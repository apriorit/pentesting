# XnView Standard v2.48 TIF processing OOB, xnview+0x32e546

Last version at the moment of publication is 2.48

![](https://i.imgur.com/IHBmtQS.png)

![](https://i.imgur.com/bJ95x8t.png)


## Steps to reproduce

1. Use XnView Standard v2.48
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable xnview.exe /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    xnview.exe: page heap enabled
```
3. Run windbg
4. Open XnView in windbg
5. Open testcase in XnView

## The bug

TIF file processing OOB

```
(1050.54c): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=07f26000 ebx=07f26000 ecx=07f26003 edx=18793838 esi=04160d07 edi=00000000
eip=0044e546 esp=00b3bb70 ebp=00b3bba4 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206
xnview+0x32e546:
0044e546 8801            mov     byte ptr [ecx],al          ds:002b:07f26003=??
0:000> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 00b3bba4 0041e48b 08becf60 07f26000 00000118 xnview+0x32e546
01 00b3beec 0041ce09 08becf60 09134b00 00b3c084 xnview+0x2fe48b
02 00b3c174 0041c5e0 08becf60 12da0ca8 00000000 xnview+0x2fce09
03 00b3c188 00354505 08becf60 12da0ca8 12da0ca8 xnview+0x2fc5e0
04 00b3c1a4 00354424 08becf60 12da0ca8 00000000 xnview+0x234505
05 00b3c2cc 00358735 08becf60 12da0ca8 00000002 xnview+0x234424
06 00b3c300 003584cc 00b3c780 00b3c354 00b3c388 xnview+0x238735
07 00b3c328 0023334a 00b3c780 00b3c354 00b3c388 xnview+0x2384cc
08 00b3c480 00233586 0000ffff 00b3c4a0 80006011 xnview+0x11334a
09 00b3ca38 00233bcf 80006011 002f0376 00000001 xnview+0x113586
0a 00b3cb7c 76c0be6b 002f0376 0000004e 00000000 xnview+0x113bcf
0b 00b3cba8 76be9e65 00233a20 002f0376 0000004e USER32!_InternalCallWinProc+0x2b
0c 00b3cc40 76be95e7 002f0376 0000004e 00000000 USER32!UserCallDlgProcCheckWow+0x1e5
0d 00b3cc98 76be7695 068e9070 00000000 0000004e USER32!DefDlgProcWorker+0xc7
0e 00b3ccb8 76c0be6b 002f0376 0000004e 00000000 USER32!DefDlgProcA+0x25
0f 00b3cce4 76c0833a 76be7670 002f0376 0000004e USER32!_InternalCallWinProc+0x2b
10 00b3cdcc 76bebeca 912a9d10 00007ff9 0000004e USER32!UserCallWinProcCheckWow+0x3aa
11 00b3ce38 76bebc57 068e9070 00000000 00b3cf94 USER32!SendMessageWorker+0x20a
12 00b3ce7c 71b55ce0 002f0376 0000004e 00000000 USER32!SendMessageW+0x137
13 00b3cf20 71b6caca 00b3cf94 0025043a 002f0376 COMCTL32!CCSendNotify+0x2b940
14 00b3cf5c 76a9e4cf 002f0376 0025043a fffffda6 COMCTL32!SendNotify+0x3a
15 00b3d0b4 76a9f1c8 fffffda6 00000000 10ac0fa8 COMDLG32!SendOFNotify+0x7b
16 00b3d0d4 76a7ee4b 1824afd8 10c409cc 00000003 COMDLG32!CLegacyEvents::OnSelectionChange+0x38
17 00b3d0ec 71b3c6fa 1824afd8 10c409cc 10c409c0 COMDLG32!CFileOpenSave::_NotifySelectionChangeCallback+0x2b
18 00b3d108 76a6b51c 1824cfe8 76a7ee20 10c409cc COMCTL32!DPA_EnumCallback+0x3a
19 00b3d118 76a7edb1 00000000 10c409c0 00000000 COMDLG32!CFileOpenSave::NotifySelectionChangeWithoutParsing+0x1a
1a 00b3d158 76a86548 80006011 0025043a 00000001 COMDLG32!CFileOpenSave::_NotifySelectionChange+0x22
1b 00b3d1c4 76c0be6b 0025043a 0000052e 00000000 COMDLG32!CFileOpenSave::s_OpenSaveDlgProc+0x7e8
1c 00b3d1f0 76be9e65 76a85d60 0025043a 0000052e USER32!_InternalCallWinProc+0x2b
1d 00b3d288 76be95e7 0025043a 0000052e 00000000 USER32!UserCallDlgProcCheckWow+0x1e5
1e 00b3d2e4 76be9508 0689df20 00000000 0000052e USER32!DefDlgProcWorker+0xc7
1f 00b3d308 76c0be6b 0025043a 0000052e 00000000 USER32!DefDlgProcW+0x48
20 00b3d334 76c0833a 76be94c0 0025043a 0000052e USER32!_InternalCallWinProc+0x2b
21 00b3d41c 76c07bee 912a9d20 00007ff9 0000052e USER32!UserCallWinProcCheckWow+0x3aa
22 00b3d498 76c079d0 5f21fd40 00b3d4f0 71b7ac8d USER32!DispatchMessageWorker+0x20e
23 00b3d4a4 71b7ac8d 00b3d4d0 0000003e 00000000 USER32!DispatchMessageW+0x10
24 00b3d4f0 71c835bc 00000048 00000000 00000000 COMCTL32!CheckForDragBeginEx+0xdd
25 00b3d5ac 71b4cdaf 00000000 0000005e 00000048 COMCTL32!CLVMouseManager::HandleMouse+0x828
26 00b3d734 71b1e8c7 0026031e 00000201 00000001 COMCTL32!CListView::WndProc+0x2d41f
27 00b3d760 76c0be6b 0026031e 00000201 00000001 COMCTL32!CListView::s_WndProc+0x57
28 00b3d78c 76c0833a 71b1e870 0026031e 00000201 USER32!_InternalCallWinProc+0x2b
29 00b3d874 76be7afd 71b1e870 00000000 00000201 USER32!UserCallWinProcCheckWow+0x3aa
2a 00b3d8b0 71b3aadd 71b1e870 0026031e 00000201 USER32!CallWindowProcW+0x8d
2b 00b3d938 71b3ab7b 00000201 00000001 0048005e COMCTL32!CallNextSubclassProc+0x11d
2c 00b3d9b8 71b3a876 00000201 00000001 0048005e COMCTL32!CallNextSubclassProc+0x1bb
2d 00b3d9d8 75360d11 0026031e 00000201 00000001 COMCTL32!DefSubclassProc+0x56
2e 00b3dc68 71b3aa82 0026031e 00000201 00000001 SHELL32!CListViewHost::s_ListViewSubclassWndProc+0x511
2f 00b3dcf4 71b3a935 00000201 00000001 0048005e COMCTL32!CallNextSubclassProc+0xc2
30 00b3dd50 76c0be6b 0026031e 00000201 00000001 COMCTL32!MasterSubclassProc+0xa5
31 00b3dd7c 76c0833a 71b3a890 0026031e 00000201 USER32!_InternalCallWinProc+0x2b
32 00b3de64 76c07bee 71b3a890 00000000 00000201 USER32!UserCallWinProcCheckWow+0x3aa
33 00b3dee0 76bea2c3 003107d4 00000000 0025043a USER32!DispatchMessageWorker+0x20e
34 00b3df10 76be903f 0025043a 00b3df2c 003107d4 USER32!IsDialogMessageW+0x103
35 00b3df58 76be4b0a 00000000 00000001 18254fc8 USER32!DialogBox2+0x13e
36 00b3df8c 76be4a22 003107d4 76a85d60 10c409c0 USER32!InternalDialogBox+0xdf
37 00b3dfa4 76be49db 76a30000 10c68d10 003107d4 USER32!DialogBoxIndirectParamAorW+0x32
38 00b3dfc4 76a732f6 76a30000 10c68d10 003107d4 USER32!DialogBoxIndirectParamW+0x1b
39 00b3e100 76a7d5ed 10c409c4 003107d4 00000000 COMDLG32!CFileOpenSave::Show+0x346
3a 00b3e134 76a78dc7 003107d4 00b3e17c 00000000 COMDLG32!_InvokeNewFileOpenSave+0xdb
3b 00b3e164 76a6a8e1 00b3e17c 76a4a2e0 10ac0fa8 COMDLG32!_CreateNewFileOpenSaveInProc+0xd7
3c 00b3e198 76a4b215 00b3f2d8 10ac0fa8 00000000 COMDLG32!NewGetFileName+0x122
3d 00b3e1c0 76a4afa3 4f35eb85 10abccc8 10b728f0 COMDLG32!GetFileName+0xd4
3e 00b3f2a4 76a4b9c2 00b3f438 00234618 00b3f2d8 COMDLG32!GenericGetFileNameA+0x541
3f 00b3f2ac 00234618 00b3f2d8 76c0d330 00000000 COMDLG32!GetOpenFileNameA+0x22
40 00b3f438 002a2ac7 00b3f46c 00b3f468 00000001 xnview+0x114618
41 00b3f57c 0022c433 003107d4 0001000b 00000001 xnview+0x182ac7
42 00b3f5a8 002a6826 0000001a 00000001 00000000 xnview+0x10c433
43 00b3f5c4 0022c343 003107d4 00000111 0001000b xnview+0x186826
44 00b3f5ec 002a68e9 00000111 0001000b 00000000 xnview+0x10c343
45 00b3f600 76c0be6b 003107d4 00000111 0001000b xnview+0x1868e9
46 00b3f62c 76c0833a 002a68d0 003107d4 00000111 USER32!_InternalCallWinProc+0x2b
47 00b3f714 76c07eda 002a68d0 00000000 00000111 USER32!UserCallWinProcCheckWow+0x3aa
48 00b3f778 76c0a629 0688b070 00000000 00000111 USER32!DispatchClientMessage+0xea
49 00b3f7b8 76f9b96d 00b3f7d4 00000020 00b3fa00 USER32!__fnDWORD+0x49
4a 00b3f7f0 740d2bec 76bf89ff 003107d4 00720253 ntdll!KiUserCallbackDispatcher+0x4d
4b 00b3f7f4 76bf89ff 003107d4 00720253 00b3f854 win32u!NtUserTranslateAccelerator+0xc
4c 00b3f814 002aa293 003107d4 00720253 00b3f854 USER32!TranslateAcceleratorA+0x4f
4d 00b3f9c4 004a4d80 00120000 00000000 0552fff8 xnview+0x18a293
4e 00b3fa10 76d78484 009d7000 76d78460 da2a0560 xnview+0x384d80
4f 00b3fa24 76f92ec0 009d7000 ab47218f 00000000 KERNEL32!BaseThreadInitThunk+0x24
50 00b3fa6c 76f92e90 ffffffff 76fadeca 00000000 ntdll!__RtlUserThreadStart+0x2f
51 00b3fa7c 00000000 004a4c79 009d7000 00000000 ntdll!_RtlUserThreadStart+0x1b
```
