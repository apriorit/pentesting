# ACDSee Free crash at eip IDE_ACDStd!JPEGTransW+0x2450

Last version at the moment of publication is 1.1.21

![](https://i.imgur.com/QfMdFKE.png)

## Steps to reproduce

1. Use ACDSee Free 1.1.21
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable "ACDSee Free.exe" /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    acdsee free.exe: page heap enabled
```
3. Run windbg
4. Open ACDSee in windbg
5. Open testcase in ACDSee
6. For some reason, ACDSee may require **unique file path** each time you reproducing the bug (I guess its due to caching)
7. This bug does not lead to the process' crash, but I believe it can be exploitable.

## The bug

TIF file parsing OOB

```
(3d4.81c): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=28223003 ebx=0000f600 ecx=ffffffea edx=0f8c0058 esi=28220f60 edi=0000f6ff
eip=09ae9230 esp=286cfdbc ebp=7fffffff iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206
IDE_ACDStd!JPEGTransW+0x2450:
09ae9230 8858fd          mov     byte ptr [eax-3],bl        ds:002b:28223000=??
0:007> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 286cfdc8 09ae9c2d 00000002 094a2bb0 09b04c4f IDE_ACDStd!JPEGTransW+0x2450
01 286cfdd4 09b04c4f 286cfe4c 0043db77 28220f60 IDE_ACDStd!JPEGTransW+0x2e4d
02 286cfddc 0043db77 28220f60 286cfe4c 57a5f65c IDE_ACDStd!IDP_PageDecodeStep+0x1f
03 286cfe70 004e9d03 00000000 286cfec4 290f406c ACDSee_Free+0x3db77
04 00000000 00000000 00000000 00000000 00000000 ACDSee_Free+0xe9d03
```

# UPD: 5.04.2019

Someone can say that this is not the last version of the product but this is the version which is top 1 on google's request "acdsee download".

Click the first link on this slide:
![](https://i.imgur.com/2U3izg5.png)

And you will see this:
![](https://i.imgur.com/Iv2hKOG.png)


Which is directly leading to the installer v1.1.0.21:
![](https://i.imgur.com/ffuVeOO.png)
