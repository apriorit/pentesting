# ACDSee Free crash at eip IDE_ACDStd!IEP_SetColorProfile+0xb9e7a

Last version at the moment of publication is 1.1.21

![](https://i.imgur.com/QfMdFKE.png)

## Steps to reproduce

1. Use ACDSee Free 1.1.21
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable "ACDSee Free.exe" /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    acdsee free.exe: page heap enabled
```
3. Run windbg
4. Open ACDSee in windbg
5. Open testcase in ACDSee
6. For some reason, ACDSee may require **unique file path** each time you reproducing the bug (I guess its due to caching)
7. This bug does not lead to the process' crash, but I believe it can be exploitable.

## The bug

BMP file parsing OOB (PC bitmap, Windows 3.x format, -16777200 x 16 x 24)

```
(89c.aa8): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for z:\s\apr\blackhat\tools\acdsee free\plugins\IDE_ACDStd.apl -
eax=0a7e2fbc ebx=0a7e2f94 ecx=0000000a edx=00000000 esi=0a7e2f94 edi=00000000
eip=09c20b5a esp=1cddc860 ebp=1cddc868 iopl=0         nv up ei pl nz na po nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010202
IDE_ACDStd!IEP_SetColorProfile+0xb9e7a:
09c20b5a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]
0:007> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 1cddc868 09b4967a 00000000 0a7e2f94 00000028 IDE_ACDStd!IEP_SetColorProfile+0xb9e7a
01 1cddc894 09b64bf4 1cddc9ac 25bd71ac 0043d8a7 IDE_ACDStd!JPEGTransW+0x289a
02 1cddc8a0 0043d8a7 0a7e2f60 1cddc9ac 25bd71ac IDE_ACDStd!IDP_PageDecode+0x24
03 1cddc8dc 004f4f48 0a7e2f60 1cddc9ac 25bd71ac ACDSee_Free+0x3d8a7
04 00000000 00000000 00000000 00000000 00000000 ACDSee_Free+0xf4f48


```
