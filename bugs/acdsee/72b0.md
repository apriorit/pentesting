# ACDSee Free crash at eip IDE_ACDStd!IEP_SetColorProfile+0xc47ff

Last version at the moment of publication is 1.1.21

![](https://i.imgur.com/QfMdFKE.png)

## Steps to reproduce

1. Use ACDSee Free 1.1.21
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable "ACDSee Free.exe" /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    acdsee free.exe: page heap enabled
```
3. Run windbg
4. Open ACDSee in windbg
5. Open testcase in ACDSee
6. For some reason, ACDSee may require **unique file path** each time you reproducing the bug (I guess its due to caching)

## The bug

TIF file parsing OOB (TIFF image data, little-endian, direntries=22, height=59408, width=16)

```
(11a4.df0): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=1461b000 ebx=089d0010 ecx=00000006 edx=00000000 esi=089d0010 edi=1461b000
eip=09c8b4df esp=2133fc7c ebp=2133fc84 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206
IDE_ACDStd!IEP_SetColorProfile+0xc47ff:
09c8b4df 660f7f07        movdqa  xmmword ptr [edi],xmm0 ds:002b:1461b000=????????????????????????????????
0:007> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 2133fc84 09c8b585 1461b000 089d0010 00000300 IDE_ACDStd!IEP_SetColorProfile+0xc47ff
01 2133fcb4 09c8b5e7 1461b000 089d0010 00000358 IDE_ACDStd!IEP_SetColorProfile+0xc48a5
02 2133fce4 09bb5fa9 1461aff8 089d0008 00000360 IDE_ACDStd!IEP_SetColorProfile+0xc4907
03 2133fd04 09bd9019 20f58e60 1461aff8 fffffeb5 IDE_ACDStd!JPEGTransW+0xf1c9
04 00000000 00000000 00000000 00000000 00000000 IDE_ACDStd!IEP_SetColorProfile+0x12339

```
