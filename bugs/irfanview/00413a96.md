# IrfanView 4.52 - 32 bit crash at eip 0040e1c3

Last version at the moment of publication is 4.52

![](https://i.imgur.com/g1WwQJj.png)

![](https://i.imgur.com/yVB75je.png)

## Steps to reproduce

1. Use IrfanView v4.52
2. Enable pageheap (without verifier reproducing process can be unstable)
```
C:\Program Files (x86)\Windows Kits\10\Debuggers\x86>gflags /p /enable i_view32.exe /full
Warning: pageheap.exe is running inside WOW64.
This scenario can be used to test x86 binaries (running inside WOW64)
but not native (IA64) binaries.

path: SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
    i_view32.exe: page heap enabled
```
3. Run windbg
4. Open irfanview in windbg
5. Open testcase in IrfanView


## The bug

PCX file parsing OOB

```
((404.44): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=074d9d00 ebx=00000001 ecx=00000000 edx=00000000 esi=074d8000 edi=00000001
eip=0040e1c3 esp=00190f20 ebp=074d7d00 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210206
image00400000+0xe1c3:
0040e1c3 8a0e            mov     cl,byte ptr [esi]          ds:002b:074d8000=??
0:000> kb
 # ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
00 00190f1c 00192c98 001932f0 00000000 0000009e image00400000+0xe1c3
01 00190f20 001932f0 00000000 0000009e 00000300 0x192c98
02 00192cd0 76bebc57 05c5e990 00000000 00000000 0x1932f0
03 00000000 00000000 00000000 00000000 00000000 USER32!SendMessageW+0x137
```
